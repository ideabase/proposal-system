{# /templates/clients/_category.twig #}

{% extends '_layout' %}

{% block content %}

  {# page title #}
  <h1>{{ category.title }}</h1>

  {# addresses #}
  <h2>
    {# make heading plural if client has more than one address #}
    {% if category.addresses.all()|length == 1 %}Address{% else %}Addresses{% endif %}
  </h2>
  {# TODO: check if addresses exist #}
  {# begin addresses loop #}
  {% for block in category.addresses.all() %}
    {% set count = 1 %}
    {% if count > 1 %}
      <h4>Address {{ count }}</h4>
    {% endif %}

    <div>
      <p>{{ block.clientAddress1 }}</p>

      {% if block.clientAddress2 is not empty %}
        <p>{{ block.clientAddress2 }}</p>
      {% endif %}

      <p>{{ block.clientCity }}, {{ block.clientState }} {{ block.clientZipCode }}</p>

      {% if block.clientAddressDescription is not empty %}
        <p>{{ block.clientAddressDescription }}</p>
      {% endif %}
    </div>
  {% endfor %}
  {# end addresses loop #}

  {# contacts #}
  <h2>
    {# make heading plural if client has more than one contact #}
    {% if category.contacts.all()|length == 1 %}Contact{% else %}Contacts{% endif %}
  </h2>
  {# TODO: check if contacts exist #}
  {# begin contacts loop #}
  {% for block in category.contacts.all() %}
    {% set count = 1 %}
    {% if count > 1 %}
      <h4>Contact {{ count }}</h4>
    {% endif %}
    <div>
      {# IMPORTANT: HTML WILL CHANGE IF <p> IS FORMATTED - prints prefix if exists, first name, last name, suffix if exists, title if exists #}
      <p>{% if block.contactPrefix is not empty %}{{ block.contactPrefix }}&nbsp;{% endif %}{{ block.contactFirstName }}&nbsp;{{ block.contactLastName }}{% if block.contactSuffix is not empty %}{% if block.contactSuffix == "I"|upper or block.contactSuffix == "II"|upper or block.contactSuffix == "III"|upper or block.contactSuffix == "IV"|upper or block.contactSuffix == "V"|upper %}&nbsp;{{ block.contactSuffix|upper }}&nbsp;{% else %}&comma;&nbsp;{{ block.contactSuffix }}&nbsp;{% endif %}{% endif %}{% if block.contactTitle is not empty %}&sol;&nbsp;{{ block.contactTitle }}{% endif %}</p>

      {% if block.contactPhone is not empty %}
        <p>{{ block.contactPhone }}</p>
      {% endif %}

      {% if block.contactEmail is not empty %}
        <p>{{ block.contactEmail }}</p>
      {% endif %}

      {% if block.contactOtherInformation is not empty %}
        <p>{{ block.contactOtherInformation }}</p>
      {% endif %}
    </div>
  {% endfor %}
  {# end contacts loop #}

  {# proposals #}
  <h2>
    {# make heading plural if client has more than one proposal #}
    {% if craft.categories.group('clients').title(category.title).all()|length == 1 %}Proposal{% else %}Proposals{% endif %}
  </h2>
  {# TODO: check if proposals exist #}
  {# begin proposals loop #}
  {% for entry in craft.entries.section('proposals').relatedTo(category).all() %}
      <a href="{{ entry.url }}" target="_blank">{{ entry.title }}</a>
  {% endfor %}
  {# end proposals loop #}

{% endblock %}
{# end content block #}
